<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Tickets API</title>
</head>
<body>
    <script>
        const tickets = [
            { ticket_id: 'T001', customer_id: '1001', issue_type: 'Payment Issue', ticket_date: '2022-07-19', resolution_status: 'closed' },
            { ticket_id: 'T002', customer_id: '1002', issue_type: 'delivery delay', ticket_date: '19-07-2022', resolution_status: 'pending' },
            { ticket_id: 'T003', customer_id: '1003', issue_type: 'PAYMENT ISSUE', ticket_date: '20220720', resolution_status: 'Closed' },
            { ticket_id: 'T004', customer_id: '1004', issue_type: 'login problem', ticket_date: '2022/07/20', resolution_status: '' },
            { ticket_id: 'T005', customer_id: '1005', issue_type: 'NA', ticket_date: 'n/a', resolution_status: 'resolved' },
            { ticket_id: 'T006', customer_id: '1006', issue_type: 'refund request', ticket_date: '2022/07/21', resolution_status: 'Pending' },
            { ticket_id: 'T007', customer_id: '1007', issue_type: 'Delivery Delay', ticket_date: '21-07-2022', resolution_status: 'Closed' },
            { ticket_id: 'T008', customer_id: '1008', issue_type: 'Product damaged', ticket_date: '20220722', resolution_status: 'Resolved' },
            { ticket_id: 'T009', customer_id: '1009', issue_type: 'login issue', ticket_date: '2022/07/23', resolution_status: 'pending' },
            { ticket_id: 'T010', customer_id: '1010', issue_type: 'Support needed', ticket_date: '2022-07-23', resolution_status: '' },
            { ticket_id: 'T011', customer_id: '1011', issue_type: 'wrong item', ticket_date: '23/07/2022', resolution_status: 'Closed' },
            { ticket_id: 'T012', customer_id: '1012', issue_type: 'NA', ticket_date: '2022-07-24', resolution_status: 'Resolved' },
            { ticket_id: 'T013', customer_id: '1013', issue_type: 'refund', ticket_date: '2022-07-25', resolution_status: 'Closed' },
            { ticket_id: 'T014', customer_id: '1014', issue_type: 'cancelled item', ticket_date: '2022-07-25', resolution_status: 'closed' },
            { ticket_id: 'T015', customer_id: '1015', issue_type: 'Payment error', ticket_date: '26-07-2022', resolution_status: 'Pending' }
        ];

        const params = new URLSearchParams(window.location.search);
        const api = params.get('api');
        
        let response;
        let contentType = 'application/json';
        
        if (api === 'tickets') {
            const id = params.get('id');
            const status = params.get('status');
            const issue_type = params.get('issue_type');
            const customer_id = params.get('customer_id');

            if (id) {
                const ticket = tickets.find(t => t.ticket_id === id);
                response = ticket || { error: 'Ticket not found' };
            } else {
                let filtered = tickets;
                if (status) filtered = filtered.filter(t => t.resolution_status.toLowerCase() === status.toLowerCase());
                if (issue_type) filtered = filtered.filter(t => t.issue_type.toLowerCase().includes(issue_type.toLowerCase()));
                if (customer_id) filtered = filtered.filter(t => t.customer_id === customer_id);
                response = { count: filtered.length, tickets: filtered };
            }
            document.body.innerHTML = '<pre style="margin:0;font-family:monospace;white-space:pre-wrap;">' + JSON.stringify(response, null, 2) + '</pre>';
            
        } else if (api === 'stats') {
            const stats = {
                total: tickets.length,
                by_status: {},
                by_issue_type: {}
            };
            tickets.forEach(t => {
                const status = t.resolution_status.toLowerCase() || 'unknown';
                const issue = t.issue_type.toLowerCase();
                stats.by_status[status] = (stats.by_status[status] || 0) + 1;
                stats.by_issue_type[issue] = (stats.by_issue_type[issue] || 0) + 1;
            });
            document.body.innerHTML = '<pre style="margin:0;font-family:monospace;white-space:pre-wrap;">' + JSON.stringify(stats, null, 2) + '</pre>';
            
        } else if (api === 'csv') {
            const csv = 'ticket_id,customer_id,issue_type,ticket_date,resolution_status\n' + 
                tickets.map(t => `${t.ticket_id},${t.customer_id},${t.issue_type},${t.ticket_date},${t.resolution_status}`).join('\n');
            document.body.innerHTML = '<pre style="margin:0;font-family:monospace;white-space:pre-wrap;">' + csv + '</pre>';
            
        } else {
            // Documentation page when no API param
            document.body.innerHTML = `
                <style>
                    body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
                    .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                    h1 { color: #333; }
                    .endpoint { background: #f0f0f0; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 14px; word-break: break-all; }
                    .method { display: inline-block; background: #4CAF50; color: white; padding: 3px 8px; border-radius: 3px; font-size: 12px; margin-right: 10px; }
                </style>
                <div class="card">
                    <h1>ðŸš€ Support Tickets Mock API</h1>
                    <p><strong>Base URL:</strong> ${window.location.origin}${window.location.pathname}</p>
                </div>
                
                <div class="card">
                    <h2>Available Endpoints:</h2>
                    
                    <h3><span class="method">GET</span> All Tickets</h3>
                    <div class="endpoint">${window.location.origin}${window.location.pathname}?api=tickets</div>
                    
                    <h3><span class="method">GET</span> Single Ticket</h3>
                    <div class="endpoint">${window.location.origin}${window.location.pathname}?api=tickets&id=T001</div>
                    
                    <h3><span class="method">GET</span> Filter by Status</h3>
                    <div class="endpoint">${window.location.origin}${window.location.pathname}?api=tickets&status=pending</div>
                    
                    <h3><span class="method">GET</span> Statistics</h3>
                    <div class="endpoint">${window.location.origin}${window.location.pathname}?api=stats</div>
                    
                    <h3><span class="method">GET</span> CSV Format</h3>
                    <div class="endpoint">${window.location.origin}${window.location.pathname}?api=csv</div>
                </div>
                
                <div class="card">
                    <h3>Query Parameters:</h3>
                    <ul>
                        <li><strong>status</strong> - Filter by resolution status (pending, closed, resolved)</li>
                        <li><strong>issue_type</strong> - Filter by issue type</li>
                        <li><strong>customer_id</strong> - Filter by customer ID</li>
                        <li><strong>id</strong> - Get specific ticket by ID</li>
                    </ul>
                </div>
            `;
        }
    </script>
</body>
</html>
